@page "{id:int}"
@model LoyalKullaniciTakip.Pages.Personel.DetailsModel
@{
    ViewData["Title"] = "Personel Detayları";
}

<h1>Personel Detayları</h1>

<hr />

<div class="row">
    <div class="col-md-10">
        <!-- Kişisel Bilgiler -->
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">Kişisel Bilgiler</h5>
            </div>
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start mb-3">
                    <div class="flex-grow-1">
                        <!-- Personal info will go here -->
                    </div>
                    <div class="profile-photo-container position-relative" style="cursor: pointer;" data-bs-toggle="modal" data-bs-target="#photoUploadModal">
                        @if (!string.IsNullOrEmpty(Model.Personel.FotografDosyaYolu))
                        {
                            <img src="@Model.Personel.FotografDosyaYolu" alt="Profil Fotoğrafı" class="rounded-circle" style="width: 100px; height: 100px; object-fit: cover; border: 3px solid #0d6efd;" />
                        }
                        else
                        {
                            <div class="rounded-circle bg-secondary d-flex align-items-center justify-content-center" style="width: 100px; height: 100px; border: 3px solid #0d6efd;">
                                <i class="bi bi-person-circle text-white" style="font-size: 60px;"></i>
                            </div>
                        }
                        <div class="position-absolute bottom-0 end-0 bg-primary rounded-circle d-flex align-items-center justify-content-center" style="width: 30px; height: 30px;">
                            <i class="bi bi-pencil-fill text-white" style="font-size: 12px;"></i>
                        </div>
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label class="form-label fw-bold">Ad:</label>
                        <p class="form-control-plaintext">@Model.Personel.Ad</p>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label fw-bold">Soyad:</label>
                        <p class="form-control-plaintext">@Model.Personel.Soyad</p>
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-md-6">
                        <label class="form-label fw-bold">TC Kimlik No:</label>
                        <p class="form-control-plaintext">@Model.Personel.TCKimlikNo</p>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label fw-bold">Doğum Tarihi:</label>
                        <p class="form-control-plaintext">@Model.Personel.DogumTarihi.ToString("dd.MM.yyyy")</p>
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-md-6">
                        <label class="form-label fw-bold">Cinsiyet:</label>
                        <p class="form-control-plaintext">@Model.Personel.Cinsiyet</p>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <label class="form-label fw-bold">Departman:</label>
                        <p class="form-control-plaintext">@(Model.Personel.Departman?.Tanim ?? "Belirtilmemiş")</p>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label fw-bold">Meslek:</label>
                        <p class="form-control-plaintext">@(Model.Personel.Meslek?.Tanim ?? "Belirtilmemiş")</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- SGK Detay Bilgileri -->
        <div class="card mb-4">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0">SGK Detay Bilgileri</h5>
            </div>
            <div class="card-body">
                @if (Model.Personel.Personel_Detay_SGK != null)
                {
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label fw-bold">İşe Giriş Tarihi:</label>
                            <p class="form-control-plaintext">@Model.Personel.Personel_Detay_SGK.IseGirisTarihi.ToString("dd.MM.yyyy")</p>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-bold">İşyeri Sicil No:</label>
                            <p class="form-control-plaintext">@Model.Personel.Personel_Detay_SGK.IsyeriSicilNo</p>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <label class="form-label fw-bold">Çalışma Tipi:</label>
                            <p class="form-control-plaintext">@(Model.Personel.Personel_Detay_SGK.CalismaTipi?.Tanim ?? "Belirtilmemiş")</p>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-bold">SGK Meslek Kodu:</label>
                            <p class="form-control-plaintext">@(Model.Personel.Personel_Detay_SGK.MeslekKodu != null ? $"{Model.Personel.Personel_Detay_SGK.MeslekKodu.Kod} - {Model.Personel.Personel_Detay_SGK.MeslekKodu.Tanim}" : "Belirtilmemiş")</p>
                        </div>
                    </div>
                }
                else
                {
                    <p class="text-muted">SGK detay bilgisi bulunmamaktadır.</p>
                }
            </div>
        </div>

        <!-- Muhasebe Detay Bilgileri -->
        <div class="card mb-4">
            <div class="card-header bg-warning text-dark">
                <h5 class="mb-0">Muhasebe Detay Bilgileri</h5>
            </div>
            <div class="card-body">
                @if (Model.Personel.Personel_Detay_Muhasebe != null)
                {
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label fw-bold">Temel Maaş:</label>
                            <p class="form-control-plaintext">@Model.Personel.Personel_Detay_Muhasebe.TemelMaas.ToString("N2") ₺</p>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-bold">Maaş Tipi:</label>
                            <p class="form-control-plaintext">@Model.Personel.Personel_Detay_Muhasebe.MaasTipi</p>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-12">
                            <label class="form-label fw-bold">IBAN:</label>
                            <p class="form-control-plaintext">@Model.Personel.Personel_Detay_Muhasebe.IBAN</p>
                        </div>
                    </div>
                }
                else
                {
                    <p class="text-muted">Muhasebe detay bilgisi bulunmamaktadır.</p>
                }
            </div>
        </div>

        <!-- İletişim Bilgileri -->
        <div class="card mb-4">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0">İletişim Bilgileri</h5>
            </div>
            <div class="card-body">
                @if (Model.Personel.IletisimBilgileri != null && Model.Personel.IletisimBilgileri.Any())
                {
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>İletişim Tipi</th>
                                <th>Değer</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var iletisim in Model.Personel.IletisimBilgileri)
                            {
                                <tr>
                                    <td>@iletisim.IletisimTipi.Tanim</td>
                                    <td>@iletisim.Deger</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                }
                else
                {
                    <p class="text-muted">İletişim bilgisi bulunmamaktadır.</p>
                }
            </div>
        </div>

        <!-- Belge Yükleme -->
        <div class="card mb-4">
            <div class="card-header bg-secondary text-white">
                <h5 class="mb-0">Belge Yükle</h5>
            </div>
            <div class="card-body">
                <form method="post" asp-page-handler="UploadBelge" enctype="multipart/form-data">
                    <div asp-validation-summary="ModelOnly" class="text-danger mb-3"></div>

                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label for="BelgeAdi" class="form-label">Belge Adı</label>
                            <input asp-for="BelgeAdi" class="form-control" required />
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="BelgeKategoriID" class="form-label">Belge Kategorisi</label>
                            <select asp-for="BelgeKategoriID" class="form-select" asp-items="ViewBag.BelgeKategorileriList" required>
                                <option value="">Seçiniz...</option>
                            </select>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="UploadedFile" class="form-label">Dosya</label>
                            <input asp-for="UploadedFile" type="file" class="form-control" required />
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary">Yükle</button>
                </form>
            </div>
        </div>

        <!-- Yüklü Belgeler -->
        <div class="card mb-4">
            <div class="card-header bg-dark text-white">
                <h5 class="mb-0">Yüklü Belgeler</h5>
            </div>
            <div class="card-body">
                @if (Model.Personel.Belgeler != null && Model.Personel.Belgeler.Any())
                {
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>Belge Adı</th>
                                <th>Kategori</th>
                                <th>Yüklenme Tarihi</th>
                                <th>İşlemler</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var belge in Model.Personel.Belgeler.OrderByDescending(b => b.YuklenmeTarihi))
                            {
                                <tr>
                                    <td>@belge.BelgeAdi</td>
                                    <td>@belge.BelgeKategori.Tanim</td>
                                    <td>@belge.YuklenmeTarihi.ToString("dd.MM.yyyy HH:mm")</td>
                                    <td>
                                        <a href="@belge.DosyaYolu" target="_blank" class="btn btn-sm btn-info">Görüntüle</a>
                                        <a href="@belge.DosyaYolu" download class="btn btn-sm btn-success">İndir</a>
                                        <a asp-page="/Belge/Edit" asp-route-belgeId="@belge.BelgeID" class="btn btn-sm btn-warning">Düzenle</a>
                                        <a asp-page="/Belge/Delete" asp-route-belgeId="@belge.BelgeID" class="btn btn-sm btn-danger">Sil</a>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                }
                else
                {
                    <p class="text-muted">Henüz belge yüklenmemiştir.</p>
                }
            </div>
        </div>

        <!-- Eğitim Bilgileri -->
        <div class="card mb-4">
            <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Eğitim Bilgileri</h5>
                <a asp-page="/Egitim/Create" asp-route-personelId="@Model.Personel.PersonelID" class="btn btn-light btn-sm">
                    Yeni Eğitim Ekle
                </a>
            </div>
            <div class="card-body">
                @if (Model.Personel.EgitimBilgileri != null && Model.Personel.EgitimBilgileri.Any())
                {
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>Seviye</th>
                                <th>Okul Adı</th>
                                <th>Bölüm</th>
                                <th>Mezuniyet Yılı</th>
                                <th>İşlemler</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var egitim in Model.Personel.EgitimBilgileri.OrderByDescending(e => e.MezuniyetYili))
                            {
                                <tr>
                                    <td>@egitim.Seviye</td>
                                    <td>@egitim.OkulAdi</td>
                                    <td>@egitim.Bolum</td>
                                    <td>@egitim.MezuniyetYili</td>
                                    <td>
                                        <a asp-page="/Egitim/Edit" asp-route-egitimId="@egitim.EgitimKayitID" class="btn btn-sm btn-warning">Düzenle</a>
                                        <a asp-page="/Egitim/Delete" asp-route-egitimId="@egitim.EgitimKayitID" class="btn btn-sm btn-danger">Sil</a>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                }
                else
                {
                    <p class="text-muted">Henüz eğitim bilgisi eklenmemiştir.</p>
                }
            </div>
        </div>

        <!-- Zimmet Bilgileri -->
        <div class="card mb-4">
            <div class="card-header bg-danger text-white d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Zimmet Bilgileri</h5>
                <a asp-page="/Zimmet/Create" asp-route-personelId="@Model.Personel.PersonelID" class="btn btn-light btn-sm">
                    Yeni Zimmet Ekle
                </a>
            </div>
            <div class="card-body">
                @if (Model.Personel.Zimmetler != null && Model.Personel.Zimmetler.Any())
                {
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>Demirbaş Adı</th>
                                <th>Marka/Model</th>
                                <th>Seri No</th>
                                <th>Veriliş Tarihi</th>
                                <th>İade Tarihi</th>
                                <th>İşlemler</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var zimmet in Model.Personel.Zimmetler.OrderByDescending(z => z.VerilisTarihi))
                            {
                                <tr class="@(zimmet.IadeTarihi.HasValue ? "table-secondary" : "")">
                                    <td>@zimmet.DemirbasAdi</td>
                                    <td>@zimmet.MarkaModel</td>
                                    <td>@zimmet.SeriNo</td>
                                    <td>@zimmet.VerilisTarihi.ToString("dd.MM.yyyy")</td>
                                    <td>@(zimmet.IadeTarihi.HasValue ? zimmet.IadeTarihi.Value.ToString("dd.MM.yyyy") : "Zimmetli")</td>
                                    <td>
                                        @if (!zimmet.IadeTarihi.HasValue)
                                        {
                                            <a asp-page="/Zimmet/Edit" asp-route-zimmetId="@zimmet.ZimmetID" class="btn btn-sm btn-warning">Düzenle</a>
                                            <a asp-page="/Zimmet/Delete" asp-route-zimmetId="@zimmet.ZimmetID" class="btn btn-sm btn-danger">İade Et/Sil</a>
                                        }
                                        else
                                        {
                                            <span class="text-muted">İade Edildi</span>
                                        }
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                }
                else
                {
                    <p class="text-muted">Henüz zimmet kaydı bulunmamaktadır.</p>
                }
            </div>
        </div>

        <!-- Muhasebe Hareketleri -->
        <div class="card mb-4">
            <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Muhasebe Hareketleri</h5>
                <a asp-page="/Muhasebe/Create" asp-route-personelId="@Model.Personel.PersonelID" class="btn btn-light btn-sm">
                    Yeni Hareket Ekle
                </a>
            </div>
            <div class="card-body">
                @if (Model.Personel.MuhasebeHareketleri != null && Model.Personel.MuhasebeHareketleri.Any())
                {
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>Hareket Tipi</th>
                                <th>Tutar</th>
                                <th>Tarih</th>
                                <th>Açıklama</th>
                                <th>İşlemler</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var hareket in Model.Personel.MuhasebeHareketleri.OrderByDescending(h => h.Tarih))
                            {
                                <tr>
                                    <td>@hareket.HareketTipi.Tanim</td>
                                    <td>@hareket.Tutar.ToString("N2") ₺</td>
                                    <td>@hareket.Tarih.ToString("dd.MM.yyyy")</td>
                                    <td>@hareket.Aciklama</td>
                                    <td>
                                        <a asp-page="/Muhasebe/Edit" asp-route-hareketId="@hareket.HareketID" class="btn btn-sm btn-warning">Düzenle</a>
                                        <a asp-page="/Muhasebe/Delete" asp-route-hareketId="@hareket.HareketID" class="btn btn-sm btn-danger">Sil</a>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                }
                else
                {
                    <p class="text-muted">Henüz muhasebe hareketi bulunmamaktadır.</p>
                }
            </div>
        </div>

        <!-- İşlem Butonları -->
        <div class="mb-3">
            <a asp-page="./Edit" asp-route-id="@Model.Personel.PersonelID" class="btn btn-warning">Düzenle</a>
            <a asp-page="./Index" class="btn btn-secondary">Listeye Dön</a>
        </div>
    </div>
</div>

<!-- Photo Upload Modal -->
<div class="modal fade" id="photoUploadModal" tabindex="-1" aria-labelledby="photoUploadModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="photoUploadModalLabel">Profil Fotoğrafı Değiştir</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form method="post" asp-page-handler="UploadFotograf" enctype="multipart/form-data">
                <div class="modal-body">
                    <div class="text-center mb-3">
                        @if (!string.IsNullOrEmpty(Model.Personel.FotografDosyaYolu))
                        {
                            <img src="@Model.Personel.FotografDosyaYolu" alt="Profil Fotoğrafı" class="img-thumbnail mb-3" style="max-width: 200px; max-height: 200px;" />
                        }
                        else
                        {
                            <div class="alert alert-secondary" role="alert">
                                <i class="bi bi-person-circle" style="font-size: 80px;"></i>
                                <p class="mb-0">Henüz profil fotoğrafı yüklenmemiştir.</p>
                            </div>
                        }
                    </div>
                    <div class="mb-3">
                        <label for="ProfilFotografi" class="form-label">Yeni Fotoğraf Seçin</label>
                        <input asp-for="ProfilFotografi" type="file" class="form-control" accept="image/*" required />
                        <div class="form-text">JPG, JPEG, PNG veya GIF formatında dosya yükleyebilirsiniz.</div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">İptal</button>
                    <button type="submit" class="btn btn-primary">Fotoğrafı Yükle</button>
                </div>
            </form>
        </div>
    </div>
</div>

<style>
    .profile-photo-container {
        transition: transform 0.2s;
    }
    .profile-photo-container:hover {
        transform: scale(1.05);
    }
</style>
